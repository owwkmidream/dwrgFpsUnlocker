stateDiagram-v2

    state S
    {
        state "句柄=释放 损坏=否 定时器=停止 持续=否" as S_P
    }

    state S_初始化 <<choice>>
    S-->S_初始化 : 初始化
    S_初始化-->R : 顺利
    S_初始化-->B : 出错

    state R
    {
        state "句柄=持有 损坏=否 定时器=运行 持续=否" as R_P
    }

    state R_写入 <<choice>>
    R-->R_写入:写入
    R_写入-->R:顺利
    R_写入-->B:损坏

    R-->U:定时释放
    R-->K:请求保持

    R-->R:取消保持⭕

    state B
    {
        state "-- 损坏=是 -- --" as B_P
    }
    B-->B_写入:::NOWHERE:写入❌
    B-->B:释放⭕/\n取消保持⭕
    B-->B_保持:::NOWHERE:请求保持❌

    state U
    {
        state "句柄=释放 损坏=否 定时器=停止 持续=否" as U_P
    }

    state U_申请 <<choice>>
    state U_写入 <<choice>>
    U-->U_申请:写入，需要申请
    U_申请-->U_写入:成功，开始写入
    U_申请-->B:失败
    U_写入-->R:顺利
    U_写入-->B:损坏

    U-->K:请求保持

    U-->U:取消保持⭕

    U-->U_释放:::NOWHERE:定时释放❌


    state K
    {
        state "句柄=持有 损坏=否 定时器=停止 持续=是" as K_P
    }

    state K_写入 <<choice>>
    K-->K_写入:写入
    K_写入-->K:顺利
    K_写入-->B:损坏

    K-->R:取消保持

    K-->K:请求保持⭕

    K-->K_释放:::NOWHERE:定时释放❌

classDef NOWHERE fill:#0000,stroke:#0000,color:#0000,strike:yellow
